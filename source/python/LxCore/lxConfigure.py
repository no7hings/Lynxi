# coding:utf-8
from LxCore import lxBasic
LynxiPipelineTds = [
    'dongchangbao',
    'changbao.dong'
]

LynxiPipelineTdPost = 'Pipeline - TD'
LynxiPipelineTdLevel = 3
pipelineTdBasicPaths = [
    'E:/myworkspace/td/lynxi'
]
# Environ Key
Lynxi_Key_Environ_Project = 'LYNXI_PROJECT'

Lynxi_Key_Environ_Path_Plug_Maya_Local = 'LYNXI_MAYA_PUSH_PATH'
Lynxi_Key_Environ_Path_Plug_Maya_Server = 'LYNXI_MAYA_PLUG_PATH'
Lynxi_Key_Environ_Path_Plug_Windows_Local = 'LYNXI_WINDOWS_PUSH_PATH'
Lynxi_Key_Environ_Path_Plug_Windows_Server = 'LYNXI_WINDOWS_PLUG_PATH'

LynxiUi_Value_TooltipDelayTime = 1000

Lynxi_Folder_Basic = '.lynxi'
Lynxi_App_Maya = 'maya'
LynxiPresetKey = 'preset'
LynxiPipelinePresetKey = 'pipeline'
LynxiVariantPresetKey = 'variant'
LynxiPersonnelPresetKey = 'personnel'
LynxiSoftwarePresetKey = 'software'
LynxiMayaPresetKey = 'maya'
Lynxi_Key_Preset_Project = 'project'
LynxiBasicPresetKey = 'basic'
LynxiDeploymentPresetKey = 'deployment'
LynxiEnvironPresetKey = 'environ'
LynxiSetPresetKey = 'set'
LynxiEpisodePresetKey = 'episode'
LynxiProductionPresetKey = 'production'
LynxiInspectionPresetKey = 'Inspection'
LynxiPreferencePresetKey = 'preference'
LynxiOptionPresetKey = 'option'
LynxiAssetPresetKey = 'asset'
LynxiSceneryPresetKey = 'scenery'
LynxiScenePresetKey = 'scene'
LynxiAnimationPresetKey = 'animation'
LynxiDefinitionPresetKey = 'definition'
LynxiDevelopmentPresetKey = 'development'
LynxiTeamPresetKey = 'team'
LynxiPostPresetKey = 'post'
LynxiUserPresetKey = 'user'
LynxiStoragePresetKey = 'storage'
LynxiRootPresetKey = 'root'
LynxiFilePresetKey = 'file'
LynxiNamePresetKey = 'name'
LynxiDataPresetKey = 'data'
LynxiDatabasePresetKey = 'database'
LynxiDirectoryPresetKey = 'directory'
LynxiNodePresetKey = 'node'
LynxiAttributePresetKey = 'attribute'
LynxiCustomizationPresetKey = 'customization'
LynxiShelfPresetKey = 'shelf'
LynxiShelfToolPresetKey = 'shelfTool'
LynxiKitPresetKey = 'kit'
LynxiAppPresetKey = 'app'
Lynxi_Key_Plug_PresetKey = 'plug'
LynxiRendererPresetKey = 'renderer'
LynxiVersionPresetKey = 'version'
LynxiScriptPresetKey = 'script'
LynxiTdPresetKey = 'td'
LynxiGeneralValue = 'General'
LynxiValue_Unspecified = 'Unspecified'
LynxiDefaultPresetValue = 'Preset_2018'
LynxiDefaultPipelineValue = 'Pipeline_2018'
LynxiDefaultVariantValue = 'Variant_2018'
LynxiDefaultPersonnelValue = 'Personnel_2018'
LynxiDefaultSoftwareValue = 'Software_2018'
LynxiDefaultMayaValue = 'Maya_2018'
Lynxi_Keyword_Project_Default = 'Default_Project'
LynxiDefaultProjectValue = 'Default_Project_2017'
LynxiDefaultSchemeValue = 'Default_Scheme'
LynxiPostLevelKey = 'postLevel'
LynxiUserEnNameKey = 'enName'
LynxiUserCnNameKey = 'cnName'
LynxiUserMailKey = 'mail'
LynxiUserSendMailEnabledKey = 'sendMail'
LynxiDefaultEpisodeKey = '001A'
LynxiMayaTimeUnitKey = 'mayaTimeUnit'
LynxiDefaultTimeUnitValue = '24 fps'
LynxiProjectClassificationKey = 'projectClassification'
LynxiFilmProjectValue = 'Film'
LynxiCgProjectValue = 'CG'
LynxiGameProjectValue = 'Game'
LynxiAppNameKey = 'appName'
LynxiAppNamesKey = 'appNames'
LynxiAppVersionKey = 'appVersion'
LynxiAppVersionsKey = 'appVersions'
LynxiShelfNameKey = 'shelfName'
LynxiToolNameKey = 'toolName'
LynxiScriptNameKey = 'scriptName'

Lynxi_Key_Plug_Name = 'plugName'
Lynxi_Key_Plug_Version = 'plugVersion'
Lynxi_Key_Plug_Versions = 'plugVersions'
Lynxi_Key_Plug_Load_Names = 'plugLoadNames'
Lynxi_Key_Plug_Load_Enable_Auto = 'autoLoad'
Lynxi_Key_Plug_Setup_Command = 'plugSetupCommand'
Lynxi_Key_Plug_Path = 'plugPath'
Lynxi_Key_Plug_Path_Deploy = 'plugDeployPath'
Lynxi_Key_Plug_Path_Module = 'plugModulePath'
Lynxi_Key_Plug_Path_Rlm = 'plugRlmPath'

LynxiVariantKey = 'key'
LynxiVariantValue = 'value'
LynxiUiNameKey = 'nameText'
LynxiUiTipKey = 'uiTip'
LynxiServerPathKey = 'serverPath'
LynxiUtilitiesPathKey = 'utilitiesPath'
LynxiLocalPathKey = 'localPath'
LynxiServerRootKey = 'serverRoot'
LynxiLocalRootKey = 'localRoot'
LynxiBackupRootKey = 'backupRoot'
LynxiMayaPackageKey = 'mayaPackage'
LynxiMayaScriptKey = 'mayaScript'
LynxiAssetUploadCommandKey = 'assetUploadCmd'
LynxiAssetLoadCommandKey = 'assetLoadCmd'
LynxiSceneUploadCommandKey = 'sceneUploadCmd'
LynxiSceneLoadCommandKey = 'sceneLoadCmd'
LynxiMayaVersionKey = 'mayaVersion'
LynxiDefaultMayaVersion = '2017'
LynxiMayaCommonPlugsKey = 'mayaCommonPlugs'
LynxiMayaRendererKey = 'mayaRenderer'
LynxiMayaSoftwareRendererValue = 'Maya - Software'
LynxiMayaHardwareRendererValue = 'Maya - Hardware'
LynxiArnoldRendererValue = 'Arnold'
LynxiRedshiftRendererValue = 'Redshift'
LynxiMayaPlugPresetKey = 'mayaPlug'
LynxiSchemeExt = '.index'
LynxiSetExt = '.set'
LynxiUiPathsep = ' > '
LynxiRootIndex_Server = 0
LynxiRootIndex_Local = 1
LynxiRootIndex_Backup = 2
LynxiRootLabelDic = {
    0: 'serverRoot',
    1: 'localRoot',
    2: 'backupRoot'
}
# Module
LynxiProduct_Module_Asset = 'asset'
LynxiProduct_Module_Scenery = 'scenery'
LynxiProduct_Module_Scene = 'scene'
LynxiProduct_Asset_Link_Model = 'model'
LynxiAstModelStages = [
    'model',
    'texture',
    'mdlShader'
]
LynxiProduct_Asset_Link_Rig = 'rig'
LynxiAstRigStages = [
    'rigLayout',
    'rigAnimation'
]
LynxiProduct_Asset_Link_Cfx = 'cfx'
LynxiAstCfxStages = [
    'groom',
    'cfxShader'
]
LynxiProduct_Asset_Link_Solver = 'solver'
LynxiAstRigSolStages = [
    'solverBind'
]
LynxiProduct_Asset_Link_Light = 'light'
LynxiAstLightStages = [
    'light',
    'lgtShader'
]
LynxiProduct_Asset_Link_Assembly = 'assembly'
LynxiAstAssemblyStages = [
    'assembly'
]
LynxiProduct_Scenery_Link_Scenery = 'scenery'
LynxiScnSceneryStages = [
    'scenery'
]
LynxiProduct_Scene_Link_layout = 'layout'
LynxiScLayoutStages = [
    'layout'
]
LynxiProduct_Scene_Link_Animation = 'animation'
LynxiScAnimationStages = [
    'blocking',
    'final',
    'polish'
]
LynxiProduct_Scene_Link_Solver = 'solver'
LynxiScSolverStages = [
    'solverSimulation'
]
LynxiProduct_Scene_Link_Simulation = 'simulation'
LynxiScSimulationStages = [
    'simulation'
]
LynxiProduct_Scene_Link_Light = 'light'
LynxiScLightStages = [
    'shader',
    'light',
    'render'
]
Lynxi_Key_Info_SourceFile = 'link'
LynxiCacheInfoKey = 'cache'
LynxiPoseCacheInfoKey = 'poseCache'
LynxiModelCacheInfoKey = 'modelCache'
LynxiSolverCacheInfoKey = 'solverCache'
LynxiExtraCacheInfoKey = 'extraCache'

Lynxi_Key_Info_Stage = 'stage'
Lynxi_Key_Info_Update = 'update'
Lynxi_Key_Info_Timestamp = 'timestamp'
Lynxi_Key_Info_Version = 'version'
Lynxi_Key_Info_User = 'user'
Lynxi_Key_Info_Artist = 'artist'
Lynxi_Key_Info_HostName = 'hostName'
Lynxi_Key_Info_Host = 'host'
Lynxi_Key_Info_Description = 'description'
Lynxi_Key_Info_Note = 'note'
Lynxi_Key_Info_Notes = 'notes'
Lynxi_Key_Info_Data = 'data'
Lynxi_Key_Info_StartFrame = 'startFrame'
Lynxi_Key_Info_EndFrame = 'endFrame'

Lynxi_Key_Info_Active = 'active'

LynxiSolverInfoKey = 'solver'
LynxiProjectInfoKey = 'project'
LynxiInfoKey_Index = 'index'
LynxiInfoKey_Class = 'classify'
LynxiInfoKey_Name = 'name'
LynxiInfoKey_Variant = 'variant'
LynxiAttributeDataKey = 'attribute'
LynxiAlembicAttrDataKey = 'alembicAttr'
LynxiConnectionDataKey = 'connection'
LynxiNhrConnectionDataKey = 'nhrConnection'
LynxiAssemblyReferenceDataKey = 'assemblyReference'
LynxiTransformationDataKey = 'transformation'
LynxiDatumKey_Extra_WorldMatrix = 'worldMatrix'
LynxiObjectShapeNameAttrName = 'lynxiShapeName'
LynxiTaskTimestampAttrName = 'lynxiTaskTimeStamp'
LynxiUpdateExt = '.update'
LynxiResultExt = '.result'
LynxiScCameraCacheType = 'cameraCache'
LynxiScAstModelCacheType = 'modelCache'
LynxiScAstCfxFurCacheType = 'cfxFurCache'
LynxiScAstExtraCacheType = 'extraCache'
# Ignore Send Message
if lxBasic.getOsUser() in LynxiPipelineTds:
    LynxiIsSendMail = False
    LynxiIsSendDingTalk = False
else:
    LynxiIsSendMail = True
    LynxiIsSendDingTalk = True
LynxiCharacterClassKey = 'character'
LynxiPropClassKey = 'prop'
LynxiAssetClassLis = [
    LynxiCharacterClassKey,
    LynxiPropClassKey
]
LynxiSceneryClassKey = 'scenery'
LynxiMainTimeTag = '0000_0000_0000'
LynxiProduct_Stage_Pending = 'pending'
LynxiProduct_Stage_Wip = 'wip'
LynxiProduct_Stage_Delivery = 'delivery'
LynxiProduct_Stage_Refine = 'refine'
LynxiProduct_Stage_Validated = 'validated'
LynxiAttrName_Object_Transparent = 'lxObjectTransparent'
LynxiAttrName_Object_RenderVisible = 'lxObjectRenderVisible'
none = ''
Lynxi_Mode_Develop_Enable_Product = False
Lynxi_Mode_Plug_Enable_Local = True
Lynxi_Mode_Plug_Enable_Module = True
varDic = globals()


def isLxPipelineTd():
    boolean = False
    user = lxBasic.getOsUser()
    if user in LynxiPipelineTds:
        boolean = True
    return boolean


def getLxVariantValue(varName):
    if varName in varDic:
        return varDic[varName]


def setLxVariantValue(varName, value):
    varDic[varName] = value


def lxProductRecordDatumDic(osFile, stage=None, description=None, notes=None):
    dic = lxBasic.orderedDict()
    dic[Lynxi_Key_Info_SourceFile] = osFile
    dic[Lynxi_Key_Info_Update] = lxBasic.getOsActiveTimestamp()
    dic[Lynxi_Key_Info_Artist] = lxBasic.getOsUser()
    dic[Lynxi_Key_Info_HostName] = lxBasic.getOsHostName()
    dic[Lynxi_Key_Info_Host] = lxBasic.getOsHost()
    dic[Lynxi_Key_Info_Stage] = stage
    dic[Lynxi_Key_Info_Description] = description
    dic[Lynxi_Key_Info_Note] = notes
    return dic


# Get Update File
def _toLxProductRecordFile(osFile):
    base = lxBasic.getOsFileBase(osFile)
    string = base + LynxiUpdateExt
    return string


# Get Update File
def _toLxProductResultFile(osFile):
    base = lxBasic.getOsFileBase(osFile)
    string = base + LynxiResultExt
    return string


class Basic(object):
    Lynxi_Path_Develop = 'e:/myworkspace/td/lynxi'

    Lynxi_Path_Plug_Local = 'c:/.lynxi/plug'

    Lynxi_Key_Environ_Version = 'LYNXI_VERSION'
    Lynxi_Key_Environ_Enable_Develop = 'LYNXI_DEVELOP'

    Lynxi_Key_Environ_Path_Plug_server = 'LYNXI_MAYA_PLUG_PATH'
    Lynxi_Key_Environ_Path_Plug_local = 'LYNXI_MAYA_PUSH_PATH'

    Lynxi_Key_Environ_Path_Plug_Maya_Local = 'LYNXI_MAYA_PUSH_PATH'
    Lynxi_Key_Environ_Path_Plug_Maya_Server = 'LYNXI_MAYA_PLUG_PATH'
    Lynxi_Key_Environ_Path_Plug_Windows_Local = 'LYNXI_WINDOWS_PUSH_PATH'
    Lynxi_Key_Environ_Path_Plug_Windows_Server = 'LYNXI_WINDOWS_PLUG_PATH'

    Lynxi_Key_Environ_Path_Basic = 'LYNXI_PATH'
    Lynxi_Key_Environ_Path_Develop = 'LYNXI_DEVELOP_PATH'
    Lynxi_Key_Environ_Path_Product = 'LYNXI_PRODUCT_PATH'

    Lynxi_Key_Environ_Path_User = 'LYNXI_USER_PATH'
    Lynxi_Key_Environ_Path_ToolKit = 'LYNXI_TOOLKIT_PATH'

    Lynxi_Folder_Log = '.log'
    Lynxi_Folder_Icon = 'icon'
    Lynxi_Folder_Source = 'source'
    Lynxi_Folder_Compile = 'compile'
    Lynxi_Folder_Plug = 'plug'

    Lynxi_Folder_Maya = 'maya'
    Lynxi_Folder_Windows = 'windows'
    Lynxi_Folder_Python = 'python'
    Lynxi_Folder_Package = 'package'
    Lynxi_Folder_Qt = 'qt'

    Lynxi_Folder_Product = 'product'

    Lynxi_Ext_Json = '.json'

    @classmethod
    def isDevelop(cls):
        boolean = False
        envData = lxBasic.getOsEnvironValue(cls.Lynxi_Key_Environ_Enable_Develop)
        if envData:
            if envData.lower() == 'true':
                boolean = True
        return boolean


class Message(Basic):
    Lynxi_Message_Enable = True
    def __init__(self):
        pass

    @classmethod
    def setEnable(cls, boolean):
        cls.Lynxi_Message_Enable = boolean

    @classmethod
    def isEnable(cls):
        return cls.Lynxi_Message_Enable

    def trace(self, text):
        if self.isEnable() is True:
            print u'# Lynxi {}'.format(lxBasic.getOsActiveViewTime())
            print u'    {}'.format(text)

    def traceResult(self, text):
        self.trace(
            u'''# Result {}'''.format(text)
        )

    def traceWarning(self, text):
        self.trace(
            u'''# Warning {}'''.format(text)
        )

    def traceError(self, text):
        self.trace(
            u'''# Error {}'''.format(text)
        )


class Root(Basic):
    def __init__(self, version=None):
        self._publishVersion = version

    def _version(self):
        if self._publishVersion is not None:
            return self._publishVersion
        return lxBasic.getOsEnvironValue(self.Lynxi_Key_Environ_Version)

    @classmethod
    def root(cls):
        data = lxBasic.getOsEnvironValue(cls.Lynxi_Key_Environ_Path_Basic)
        if data is not None:
            return data.replace('\\', '/')
        return cls.Lynxi_Path_Develop

    @classmethod
    def developRoot(cls):
        data = lxBasic.getOsEnvironValue(cls.Lynxi_Key_Environ_Path_Develop)
        if data is not None:
            return data.replace('\\', '/')
        return cls.Lynxi_Path_Develop

    @classmethod
    def productRoot(cls):
        data = lxBasic.getOsEnvironValue(cls.Lynxi_Key_Environ_Path_Product)
        if data is not None:
            return data.replace('\\', '/')
        return cls.Lynxi_Path_Develop

    @classmethod
    def userRoot(cls):
        data = lxBasic.getOsEnvironValue(cls.Lynxi_Key_Environ_Path_User)
        if data is not None:
            return data.replace('\\', '/')
        osUserDocument = lxBasic.getOsDocumentPath()
        string = u'{}/{}'.format(osUserDocument, Lynxi_Folder_Basic)
        return string

    def pythonSourceRoot(self):
        if self.isDevelop():
            return self.developPythonSourceRoot()
        return self.productPythonSourceRoot()

    @classmethod
    def developPythonSourceRoot(cls):
        return u'{}/{}/{}'.format(cls.developRoot(), cls.Lynxi_Folder_Source, cls.Lynxi_Folder_Python)

    def productPythonSourceRoot(self):
        return u'{}/{}/{}.{}'.format(self.productRoot(), self.Lynxi_Folder_Source, self.Lynxi_Folder_Python, self._version())

    def pythonCompileRoot(self):
        if self.isDevelop():
            return self.developPythonCompileRoot()
        return self.productPythonCompileRoot()

    @classmethod
    def developPythonCompileRoot(cls):
        return u'{}/{}/{}'.format(cls.developRoot(), cls.Lynxi_Folder_Compile, cls.Lynxi_Folder_Python)

    def productPythonCompileRoot(self):
        return u'{}/{}/{}.{}'.format(self.productRoot(), self. Lynxi_Folder_Compile, self.Lynxi_Folder_Python, self._version())

    def iconRoot(self):
        if self.isDevelop():
            return self.developIconRoot()
        return self.productIconRoot()

    def developIconRoot(self):
        return u'{}/{}/{}'.format(self.developRoot(), self.Lynxi_Folder_Source, self.Lynxi_Folder_Icon)

    def productIconRoot(self):
        return u'{}/{}/{}.{}'.format(self.productRoot(), self.Lynxi_Folder_Source, self.Lynxi_Folder_Icon, self._version())

    def logRoot(self):
        if self.isDevelop():
            return self.developLogRoot()
        return self.productLogRoot()

    def developLogRoot(self):
        return u'{}/{}'.format(self.developRoot(), self.Lynxi_Folder_Log)

    def productLogRoot(self):
        return u'{}/{}/{}'.format(self.productRoot(), self._version(), self.Lynxi_Folder_Log)

    def windowAppRoot(self):
        return u'{}/exe/{}'.format(self.root(), self.Lynxi_Folder_Windows)

    def pythonPackageRoot(self):
        return u'{}/{}/{}'.format(self.root(), self.Lynxi_Folder_Package, self.Lynxi_Folder_Python)

    def plugRoot(self):
        if self.isDevelop():
            if Lynxi_Mode_Develop_Enable_Product is True:
                return self.productPlugRoot()
            return self.developPlugRoot()
        return self.productPlugRoot()

    def developPlugRoot(self):
        return u'{}/{}'.format(self.developRoot(), self.Lynxi_Folder_Plug)

    def productPlugRoot(self):
        return u'{}/{}'.format(self.productRoot(), self.Lynxi_Folder_Plug)


class PlugRoot(Basic):
    def __init__(self):
        self._root = Root()

    def root(self):
        return self._root.plugRoot()

    def developRoot(self):
        return self._root.developPlugRoot()

    def productRoot(self):
        return self._root.productPlugRoot()

    @classmethod
    def userRoot(cls):
        return cls.Lynxi_Path_Plug_Local

    def windowsPlugRoot(self):
        return u'{}/{}'.format(self.root(), self.Lynxi_Folder_Windows)

    def userWindowsPlugRoot(self):
        return u'{}/{}'.format(self.userRoot(), self.Lynxi_Folder_Windows)

    def mayaRoot(self):
        return u'{}/{}'.format(self.root(), self.Lynxi_Folder_Maya)

    def userMayaRoot(self):
        return u'{}/{}'.format(self.userRoot(), self.Lynxi_Folder_Maya)

    def appRoot(self, appName, appVersion=None):
        if appVersion is not None:
            return u'{}/{}/{}'.format(self.root(), appName, appVersion)
        return u'{}/{}'.format(self.root(), appName)

    def localAppRoot(self, appName, appVersion=None):
        if appVersion is not None:
            return u'{}/{}/{}'.format(self.userRoot(), appName, appVersion)
        return u'{}/{}'.format(self.userRoot(), appName)

    def appPlugFolder(self, appName, appVersion, plugName, plugVersion=None):
        if plugVersion is not None:
            return u'{}/{}/{}'.format(self.appRoot(appName, appVersion), plugName, plugVersion)
        return u'{}/{}'.format(self.appRoot(appName, appVersion), plugName)

    def userPlugFolder(self, appName, appVersion, plugName, plugVersion=None):
        if plugVersion is not None:
            return u'{}/{}/{}'.format(self.localAppRoot(appName, appVersion), plugName, plugVersion)
        return u'{}/{}'.format(self.localAppRoot(appName, appVersion), plugName)

    def appPlugSetupFile(self, appName, appVersion, plugName, plugVersion):
        return u'{}/{}/userSetup.py'.format(self.appRoot(appName, appVersion), plugName, plugVersion)

    def userAppPlugSetupFile(self, appName, appVersion, plugName, plugVersion):
        return u'{}/{}/userSetup.py'.format(self.localAppRoot(appName, appVersion), plugName, plugVersion)

    def appPlugConfigFile(self, appName, appVersion, plugName):
        return u'{0}/{1}/{1}.config'.format(self.appRoot(appName, appVersion), plugName)

    @staticmethod
    def appDatumDic(appName, appVersion):
        dic = lxBasic.orderedDict()
        if appName != LynxiValue_Unspecified:
            osPath = PlugRoot().appRoot(appName, appVersion)
            if lxBasic.isOsExist(osPath):
                osFileNames = lxBasic.getOsFileBasenameLisByPath(osPath)
                if osFileNames:
                    for osFileName in osFileNames:
                        plug = PlugConfig(appName, appVersion, osFileName)
                        configFile = plug.configFile()
                        if lxBasic.isOsExist(configFile):
                            if plug.enable() is True:
                                plugName = osFileName
                                dic[plugName] = [
                                    False,
                                    u'插件预设',
                                    [
                                        [Lynxi_Key_Plug_Version, plug.versions()],
                                        [Lynxi_Key_Plug_Load_Names, tuple(plug.loadnames())],
                                        [Lynxi_Key_Plug_Load_Enable_Auto, False],
                                        ['loadCondition', ()]
                                    ]
                                ]
        return dic

    @staticmethod
    def mayaEnvironFile(appVersion):
        return lxBasic.getMayaAppsEnvFile(appVersion)


class App(Basic):
    def __init__(self, appName, appVersion):
        self._initApp(appName, appVersion)

    def _initApp(self, appName, appVersion):
        self._appName = appName
        self._appVersion = appVersion


class MayaApp(App):
    def __init__(self, appVersion):
        self._initApp(Lynxi_App_Maya, appVersion)

    def environFile(self):
        return lxBasic.getMayaAppsEnvFile(self._appVersion)


class PlugConfig(Basic):
    EnableKey = 'enable'
    VersionKey = 'version'
    LoadnameKey = 'loadname'
    ModulenameKey = 'modulename'

    PlugnameKey = 'plugname'
    PlugversionKey = 'plugversion'
    PlugpathKey = 'plugpath'

    DefaultConfigDic = {
        EnableKey: True,
        VersionKey: [],
        LoadnameKey: [],
        ModulenameKey: None
    }

    def __init__(self, appName, appVersion, plugName):
        self._initPlugConfig(appName, appVersion, plugName)

    def _initPlugConfig(self, appName, appVersion, plugName):
        self._plugRoot = PlugRoot()

        self._appName = appName
        self._appVersion = appVersion

        self._plugname = plugName

        self._defConfigDic = {
            self.EnableKey: True,
            self.VersionKey: [],
            self.LoadnameKey: []
        }

    def createConfig(self):
        lxBasic.writeOsJson(
            self.DefaultConfigDic,
            self.configFile()
        )

    def configFile(self):
        return u'{}/{}/config.json'.format(
            self._plugRoot.appRoot(self._appName, self._appVersion),
            self._plugname
        )

    def config(self):
        return lxBasic.readOsJson(self.configFile()) or {}

    def enable(self):
        if self.config():
            return self.config().get(self.EnableKey, False)
        return False

    def versions(self):
        if self.config():
            return self.config().get(self.VersionKey, [])
        return []

    def loadnames(self):
        if self.config():
            return self.config().get(self.LoadnameKey, [])
        return []
    
    def plugname(self):
        return self._plugname


class AppPlug(PlugConfig):
    def __init__(self, appName, appVersion, plugName, plugVersion, isDefinition=False):
        self._initAppPlug(appName, appVersion, plugName, plugVersion, isDefinition)

    def _initAppPlug(self, appName, appVersion, plugName, plugVersion, isDefinition=False):
        self._initPlugConfig(appName, appVersion, plugName)

        self._isDefinition = isDefinition

        self._plugRoot = PlugRoot()

        self._plugversion = plugVersion
    
    def plugversion(self):
        return self._plugversion

    @staticmethod
    def _createTimestampMethod(osPath, osJsonFile):
        dic = {}

        isAscii = False
        if lxBasic.isOsExist(osJsonFile) is False:
            osFiles = lxBasic.getOsFiles(osPath)
            if osFiles:
                for osFile in osFiles:
                    osFileTimestamp = str(lxBasic.getOsFileMtimestamp(osFile))
                    relativeOsFile = osFile[len(osPath):]

                    if isinstance(relativeOsFile, unicode):
                        isAscii = True

                    dic[relativeOsFile] = osFileTimestamp

        lxBasic.writeOsJson(dic, osJsonFile, ensure_ascii=isAscii)

    def createServerTimestamp(self):
        self._createTimestampMethod(
            self.serverSourcePath(),
            self.serverTimestampFile()
        )

    def createLocalTimestamp(self):
        self._createTimestampMethod(
            self.localSourcePath(),
            self.localTimestampFile()
        )

    def serverTimestampFile(self):
        return u'{}/timestamp.json'.format(
            self.serverPath()
        )

    def localTimestampFile(self):
        return u'{}/timestamp.json'.format(
            self.localPath()
        )

    def serverTimestampDatum(self):
        if lxBasic.isOsExist(self.serverTimestampFile()) is False:
            self.createServerTimestamp()
        return lxBasic.readOsJson(self.serverTimestampFile()) or {}

    def localTimestampDatum(self):
        if lxBasic.isOsExist(self.localTimestampFile()) is False:
            self.createLocalTimestamp()
        return lxBasic.readOsJson(self.localTimestampFile()) or {}

    def environFile(self):
        return u'{}/{}/{}/environ.json'.format(
            self._plugRoot.appRoot(self._appName, self._appVersion),
            self._plugname, self._plugversion
        )

    def environDatum(self):
        return lxBasic.readOsJson(self.environFile()) or []

    def appEnvironDatum(self):
        if self.environDatum():
            return '\r\n'.join([i.format(**self.dict())for i in self.environDatum()])

    def setupFile(self):
        return u'{}/{}/setup.py'.format(
            self._plugRoot.appRoot(self._appName, self._appVersion),
            self._plugname,
            self._plugversion
        )

    def setupCommand(self):
        pass

    def path(self):
        if Lynxi_Mode_Plug_Enable_Local is True:
            return self.localPath()
        return self.serverPath()

    def serverPath(self):
        if self._isDefinition is True:
            return u'{}/{}/{}'.format(
                self._plugRoot.appRoot(self._appName, 'definition'),
                self._plugname, self._plugversion
            )
        return u'{}/{}/{}'.format(
            self._plugRoot.appRoot(self._appName, self._appVersion),
            self._plugname, self._plugversion
        )

    def localPath(self):
        if self._isDefinition is True:
            return u'{}/{}/{}'.format(
                self._plugRoot.localAppRoot(self._appName, 'definition'),
                self._plugname, self._plugversion
            )
        return u'{}/{}/{}'.format(
            self._plugRoot.localAppRoot(self._appName, self._appVersion),
            self._plugname, self._plugversion
        )

    def sourcePath(self):
        return '{}/source'.format(self.path())

    def serverSourcePath(self):
        return '{}/source'.format(self.serverPath())

    def localSourcePath(self):
        return '{}/source'.format(self.localPath())

    def isLocalSourceChanged(self):
        return self.serverTimestampDatum() != self.localTimestampDatum()

    def dict(self):
        return {
            self.PlugnameKey: self.plugname(),
            self.PlugversionKey: self.plugversion(),
            self.PlugpathKey: self.sourcePath()
        }

    @staticmethod
    def _getChangedFileMethod(sourceTimestamp, targetTimestamp):
        lis = []
        for localOsFile, sourceTime in sourceTimestamp.items():
            if targetTimestamp.__contains__(localOsFile):
                targetTime = targetTimestamp[localOsFile]
                if sourceTime != targetTime:
                    lis.append(localOsFile)
            #
            else:
                lis.append(localOsFile)
        return lis

    def getChangedSourceFiles(self):
        return self._getChangedFileMethod(
            self.serverTimestampDatum(), self.localTimestampDatum()
        )

    def pushSource(self):
        changedFileLis = self.getChangedSourceFiles()
        if changedFileLis:
            for relativeOsFile in changedFileLis:
                sourceFile = self.serverSourcePath() + relativeOsFile
                targetFile = self.localSourcePath() + relativeOsFile

                lxBasic.setOsFileCopy(sourceFile, targetFile, force=False)

                traceMessage = u'Plug "{}" Update Source: "{}" > "{}"'.format(self._plugname, sourceFile, targetFile)
                Message().traceResult(traceMessage)

                lxBasic.setOsFileCopy(self.serverTimestampFile(), self.localTimestampFile())
        else:
            traceMessage = u'Plug "{}" Source is "Non - Changed"'.format(self._plugname)
            Message().traceResult(traceMessage)


class MayaPlug(AppPlug):
    def __init__(self, appVersion, plugName, plugVersion, isDefinition=False):
        self._initAppPlug(
            Lynxi_App_Maya, appVersion, plugName, plugVersion, isDefinition
        )

    def modulename(self):
        if self.config():
            return self.config().get(self.ModulenameKey, False)
        return self.plugname()

    def moduleFile(self):
        return u'{}/module.json'.format(
            self.serverPath()
        )

    def moduleDatum(self):
        return lxBasic.readOsJson(self.moduleFile()) or []

    def dict(self):
        return {
            self.ModulenameKey: self.modulename(),
            self.PlugnameKey: self.plugname(),
            self.PlugversionKey: self.plugversion(),
            self.PlugpathKey: self.sourcePath()
        }

    def appModuleDatum(self):
        if self.moduleDatum():
            return '\r\n'.join([i.format(**self.dict())for i in self.moduleDatum()])

    def appModuleFile(self):
        return '{}/{}.mod'.format(lxBasic.getMayaAppOsModPath(self._appVersion), self.modulename())

    def pushModule(self):
        origDatum = lxBasic.readOsData(self.appModuleFile())
        datum = self.appModuleDatum()
        if origDatum != datum:
            lxBasic.writeOsData(
                datum, self.appModuleFile()
            )
            traceMessage = u'Plug "{}" Update Module : "{}" '.format(self._plugname, self.appModuleFile())
            Message().traceResult(traceMessage)
        else:
            traceMessage = u'Plug "{}" Module is "Non - Changed"'.format(self._plugname)
            Message().traceResult(traceMessage)


class UserPreset(Basic):
    Folder_Preset = 'preset'

    Folder_Render = 'render'
    Folder_Project = 'project'
    Folder_Ui = 'ui'
    Folder_Filter = 'filter'
    def __init__(self):
        self._root = Root()

    def root(self):
        return u'{}/{}'.format(self._root.userRoot(), self.Folder_Preset)

    def uiRoot(self):
        return u'{}/{}'.format(self.root(), self.Folder_Ui)

    def renderRoot(self):
        return u'{}/{}'.format(self.root(), self.Folder_Render)

    def projectFile(self):
        return u'{}/{}{}'.format(self.root(), self.Folder_Project, self.Lynxi_Ext_Json)

    def appProjectFile(self, appName, appVersion):
        return u'{}/{}/{}.{}{}'.format(self.root(), self.Folder_Project, appName, appVersion, self.Lynxi_Ext_Json)

    def uiFilterHistoryFile(self):
        return u'{}/{}.history{}'.format(self.uiRoot(), self.Folder_Filter, self.Lynxi_Ext_Json)


class Version(Basic):
    def __init__(self):
        self._root = Root()

        self._file = u'{}/.info/python.version.json'.format(self._root.root())

        self._developFile = u'{}/.info/python.version.json'.format(self._root.developRoot())

        self._productFile = u'{}/.info/python.version.json'.format(self._root.productRoot())

    def _upload(self, version):
        lxBasic.writeOsJson(
            {
                Lynxi_Key_Info_Active: version,

                Lynxi_Key_Info_User: lxBasic.getOsUser(),
                Lynxi_Key_Info_Timestamp: lxBasic.getOsActiveTimestamp()
            },
            self.developFile()
        )

        lxBasic.setOsFileCopy(self.developFile(), self.productFile())

    def server(self):
        if lxBasic.isOsExistsFile(self.file()):
            return lxBasic.readOsJsonDic(self.file(), Lynxi_Key_Info_Active) or 1.0
        return u'1.0'

    def file(self):
        return self._file

    def developFile(self):
        return self._developFile

    def productFile(self):
        return self._productFile

    @classmethod
    def local(cls):
        data = lxBasic.getOsEnvironValue(cls.Lynxi_Key_Environ_Version)
        if data is not None:
            return data
        return u'1.0'

    def setLocalRefresh(self):
        serverVersion = self.server()
        lxBasic.setOsEnvironValue(self.Lynxi_Key_Environ_Version, serverVersion)
        Message().traceResult(
            u'Set Version : {}'.format(serverVersion)
        )


class Log(Basic):
    def __init__(self):
        self._root = Root()

        self._root = self._root.logRoot()

    def exceptionFile(self):
        return u'{}/{}.exception.log'.format(lxBasic.getOsActiveDateTag(), self._root)

    def errorFile(self):
        return u'{}/{}.error.log'.format(lxBasic.getOsActiveDateTag(), self._root)

    def developFile(self):
        return u'{}/{}.develop.log'.format(lxBasic.getOsActiveDateTag(), self._root)

    def addException(self, text):
        self.add(
            text,
            self.exceptionFile()
        )

    def addError(self, text):
        self.add(
            text,
            self.errorFile()
        )

    def addDevelop(self, text):
        self.add(
            text,
            self.developFile()
        )

    @staticmethod
    def add(text, osLogFile):
        lxBasic.setOsFilePathCreate(osLogFile)
        with open(osLogFile, 'a') as log:
            log.writelines(u'{} @ {}\n'.format(lxBasic.getOsActiveViewTime(), lxBasic.getOsUser()))
            log.writelines(u'{}\n'.format(text))
            log.close()


class Python(Basic):
    Lynxi_Core = 'LxCore'
    Lynxi_Database = 'LxDatabase'
    Lynxi_Ui = 'LxUi'
    Lynxi_Interface = 'LxInterface'

    Lynxi_Maya = 'LxMaya'
    Lynxi_Deadline = 'LxDeadline'

    Lynxi_Python_Module_Basic_Lis = [
        'LxCore.config.appConfig',
        'LxCore.method.basic._methodBasic',
        'LxCore.method._osMethod',
        'LxCore.method._dbMethod',
        'LxCore.method._uiMethod',
        'LxCore.method._productMethod',

        'LxCore.lxBasic',
        'LxCore.lxConfigure',
        # Ui
        'LxUi.command.uiHtml',
        'LxUi.qt.qtCore',
        'LxUi.qt.qtDefinition',
        'LxUi.qt.qtAbstract',
        'LxUi.qt.qtAction',
        'LxUi.qt.qtBasic.qtModelBasic',
        'LxUi.qt.qtBasic.qtWidgetBasic',
        'LxUi.qt.qtWidgets.qtWindow',
        'LxUi.qt.qtWidgets.qtView',
        'LxUi.qt.qtWidgets.qtGroup',
        'LxUi.qt.qtWidgets.qtItem',
        'LxUi.qt.qtWidgets',
        'LxUi.qt.qtWidgets_',
        'LxUi.qt.qtChart_',
        # Behind Ui
        'LxCore.lxLog',
        'LxCore.lxProgress',
        'LxCore.lxTip',
        'LxCore.config.appCfg',
        'LxCore.config.basicCfg',
        'LxCore.config.assetCfg',
        'LxCore.config.sceneryCfg',
        'LxCore.config.sceneCfg',
        'LxCore.preset.appPr',
        'LxCore.preset.basicPr',
        'LxCore.preset.pipePr',
        'LxCore.preset.prod.projectPr',
        'LxCore.preset.prod.assetPr',
        'LxCore.preset.prod.sceneryPr',
        'LxCore.preset.prod.scenePr',
        'LxCore.preset.plugPr',
        'LxCore.preset.personnelPr',
        'LxCore.preset.appVariant',
        'LxInterface.qt.ifAbstract',
        'LxInterface.qt.ifBasic.ifWidgetBasic',
    ]
    Lynxi_Python_Module_Maya_Lis = [
        'LxMaya.method.config._maConfig',

        'LxMaya.method.basic._maMethodBasic',

        'LxMaya.method._maUiMethod',
        'LxMaya.method._maMethod',
        'LxMaya.method._maPlugMethod',
        'LxMaya.method._maProductMethod',
        'LxMaya.method',

    ]

    def __init__(self):
        self._root = Root()

    def root(self):
        if self.isDevelop():
            return self._root.developPythonSourceRoot()
        return self._root.productPythonCompileRoot()

    @classmethod
    def relateModules(cls):
        lis = [cls.Lynxi_Core, cls.Lynxi_Database, cls.Lynxi_Ui, cls.Lynxi_Interface]
        if lxBasic.isMayaApp():
            lis.extend([cls.Lynxi_Maya, cls.Lynxi_Deadline])
        return lis

    def getPythonModules(self, modulePath, moduleString=None):
        def getBranch(directory, moduleString_=None):
            osFileNames = lxBasic.getOsFileBasenameLisByPath(directory)
            if osFileNames:
                if moduleString_:
                    if isinstance(moduleString_, tuple) or isinstance(moduleString_, list):
                        osFileNames = [j for j in osFileNames if j in list(moduleString_)]
                    if isinstance(moduleString_, str) or isinstance(moduleString_, unicode):
                        osFileNames = [j for j in osFileNames if j in [moduleString_]]

                for name in osFileNames:
                    osFile = lxBasic._toOsFile(directory, name)
                    if osFile.endswith(ext):
                        pycFile = osFile[:-len(ext)] + '.pyc'
                        if lxBasic.isOsExistsFile(pycFile):
                            timestamp = lxBasic.getOsFileMtimestamp(osFile)
                            module_ = osFile[len(modulePath) + 1:-len(ext)].replace('/', '.')

                            timestampLis.append(timestamp)
                            if module_.endswith('__init__'):
                                moduleDic[timestamp] = module_[:(-len('__init__') - 1)]
                            else:
                                moduleDic[timestamp] = module_

                    getBranch(osFile)

        if self.isDevelop():
            ext = '.py'
        else:
            ext = '.pyc'

        lis = []

        timestampLis = []
        moduleDic = {}

        getBranch(modulePath, moduleString)

        if timestampLis:
            timestampLis.sort()
            timestampLis.reverse()
            for i in timestampLis:
                if i in moduleDic:
                    module = moduleDic[i]
                    lis.append(module)

        return lis

    def setPythonModuleUpdate(self, modulePath, moduleString=none):
        moduleDatumLis = self.getPythonModules(modulePath, moduleString)
        if moduleDatumLis:
            from LxCore import lxProgress
            # View Progress
            explain = '''Update Python Module(s)'''
            maxValue = len(moduleDatumLis)
            progressBar = lxProgress.viewSubProgress(explain, maxValue)
            for i in moduleDatumLis:
                modulePath = '.'.join(i.split('.')[:-1])
                moduleName = i.split('.')[-1]

                progressBar.updateProgress(moduleName)

                if modulePath:
                    command = '''from {0} import {1};reload({1})'''.format(modulePath, moduleName)
                else:
                    command = '''import {0};reload({0})'''.format(moduleName)

                exec command

    @classmethod
    def reloadBasic(cls):
        moduleLis = cls.Lynxi_Python_Module_Basic_Lis
        if lxBasic.isMayaApp():
            moduleLis += cls.Lynxi_Python_Module_Maya_Lis

        if moduleLis:
            from LxCore import lxProgress
            # View Progress
            explain = '''Update Python Basic Module(s)'''
            maxValue = len(moduleLis)
            progressBar = lxProgress.viewSubProgress(explain, maxValue)
            for i in moduleLis:
                modulePath = '.'.join(i.split('.')[:-1])
                moduleName = i.split('.')[-1]

                progressBar.updateProgress(moduleName)

                if modulePath:
                    command = '''from {0} import {1};reload({1})'''.format(modulePath, moduleName)
                else:
                    command = '''import {0};reload({0})'''.format(moduleName)

                exec command

    def reloadAll(self):
        self.setPythonModuleUpdate(self.root(), self.relateModules())


class Ui(Basic):
    Lynxi_Key_Environ_Message_Count = 'LYNXI_MESSAGE_COUNT'
    Lynxi_Key_Environ_Enable_Tooltip_Auto = 'LYNXI_TOOLTIP_AUTO_SHOW'
    def __init__(self):
        pass

    @classmethod
    def restMessageCount(cls):
        lxBasic.setOsEnvironValue(cls.Lynxi_Key_Environ_Message_Count, '0')

    @classmethod
    def setMessageCount(cls, value):
        data = lxBasic.getOsEnvironValue(cls.Lynxi_Key_Environ_Message_Count)
        #
        if data:
            value_ = str(int(data) + value)
        else:
            value_ = str(0)
        #
        lxBasic.setOsEnvironValue(cls.Lynxi_Key_Environ_Message_Count, value_)
        return int(value_)

    @staticmethod
    def closeAll():
        from LxUi.qt import qtCore
        reload(qtCore)
        #
        w = qtCore.getAppWindow()
        if w is not None:
            cs = w.children()
            if cs:
                for i in cs:
                    moduleName = i.__class__.__module__
                    if moduleName.startswith('LxInterface.qt') or moduleName.startswith('LxUi.qt'):
                        i.deleteLater()

    @classmethod
    def setTooltipAutoShow(cls, boolean):
        envValue = str(boolean).upper()
        lxBasic.setOsEnvironValue(cls.Lynxi_Key_Environ_Enable_Tooltip_Auto, envValue)

    @classmethod
    def isTooltipAutoShow(cls):
        boolean = False
        envData = lxBasic.getOsEnvironValue(cls.Lynxi_Key_Environ_Enable_Tooltip_Auto)
        if envData:
            if envData == str(True).upper():
                boolean = True
        return boolean


class Product(Basic):
    def __init__(self):
        pass
